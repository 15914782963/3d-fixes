// Lighting in distant water background - horizontal band
// ---- Created with 3Dmigoto v1.2.44 on Mon Oct 03 01:41:01 2016
Texture3D<float4> t5 : register(t5);

Texture2D<float4> t4 : register(t4);

Texture2D<float4> t3 : register(t3);

Texture2D<float4> t2 : register(t2);

Texture2D<float4> t1 : register(t1);

Texture2D<float4> t0 : register(t0);

SamplerState s2_s : register(s2);

SamplerState s1_s : register(s1);

SamplerState s0_s : register(s0);

cbuffer cb1 : register(b1)
{
  float4 cb1[26];
}

cbuffer cb0 : register(b0)
{
  float4 cb0[54];
}




// 3Dmigoto declarations
#define cmp -
Texture1D<float4> IniParams : register(t120);
Texture2D<float4> StereoParams : register(t125);


void main( 
  float2 v0 : TEXCOORD0,
  float2 w0 : TEXCOORD1,
  float4 v1 : TEXCOORD2,
  out float4 o0 : SV_Target0)
{
  float4 r0,r1,r2,r3,r4;
  uint4 bitmask, uiDest;
  float4 fDest;

  r0.x = t4.SampleLevel(s2_s, w0.xy, 0).x;
  r0.x = r0.x * cb0[51].z + -cb0[51].w;
  r0.x = 1 / r0.x;
  r0.yzw = v1.xyz * r0.xxx;
  r1.x = t3.Sample(s1_s, w0.xy).x;
  r1.x = cmp(r1.x == 0.000000);
  if (r1.x != 0) {
    r1.xyz = cb0[1].xyw * r0.zzz;
    r1.xyz = r0.yyy * cb0[0].xyw + r1.xyz;
    r1.xyz = r0.www * cb0[2].xyw + r1.xyz;
    r1.xyz = cb0[3].xyw + r1.xyz;

// Fix lighting in the distant water background:
float4 s = StereoParams.Load(0);
r1.x -= s.x * (r0.x - s.y);

    r1.xy = r1.xy / r1.zz;
    r0.y = dot(r0.yzw, r0.yzw);
    r0.y = sqrt(r0.y);
    r0.y = saturate(cb1[10].z * r0.y);
    r0.y = log2(r0.y);
    r0.y = cb1[11].x * r0.y;
    r1.z = exp2(r0.y);
    r0.yzw = r1.xyz * float3(0.5,-0.5,1) + float3(0.5,0.5,0);
    r0.yzw = r0.yzw * cb1[15].xyz + cb1[14].xyz;
    o0.xyzw = t5.SampleLevel(s0_s, r0.yzw, 0).xyzw;
  } else {
    r0.y = v1.z * r0.x + cb0[53].z;
    r0.y = -cb1[15].w + r0.y;
    r1.x = saturate(cb1[16].x * r0.y);
    r1.y = 0;
    r0.yzw = t0.SampleLevel(s0_s, r1.xy, 0).xyz;
    r2.xyz = cb1[23].xyz + -r0.yzw;
    r0.yzw = cb1[22].xxx * r2.xyz + r0.yzw;
    r2.xyz = t1.SampleLevel(s0_s, r1.xy, 0).yzw;
    r3.xyz = cb1[24].yzw + -r2.xyz;
    r2.xyz = cb1[22].yyy * r3.xyz + r2.xyz;
    r1.zw = float2(1,1) / r2.xz;
    r3.xyzw = t2.SampleLevel(s0_s, r1.xy, 0).xyzw;
    r4.xyzw = cb1[25].xyzw + -r3.xyzw;
    r3.xyzw = cb1[22].yyyy * r4.xyzw + r3.xyzw;
    r1.x = saturate(r1.z * r0.x);
    r1.x = log2(r1.x);
    r1.x = r3.x * r1.x;
    r1.x = exp2(r1.x);
    r0.x = -r2.y + r0.x;
    r0.x = saturate(r0.x * r1.w);
    r0.x = log2(r0.x);
    r0.x = r3.y * r0.x;
    r0.x = exp2(r0.x);
    r0.x = r0.x * r3.w;
    r0.x = saturate(r1.x * r3.z + r0.x);
    o0.xyz = r0.yzw * r0.xxx;
    o0.w = 1 + -r0.x;
  }
  return;
}
