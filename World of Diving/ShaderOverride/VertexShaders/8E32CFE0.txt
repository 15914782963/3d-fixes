// Shadows (left eye had whole scene in darkness, right eye had shadow removed)

    vs_3_0
    dcl_position o0
    dcl_texcoord o1
    def c8, 0, 0, 0, 0
    dcl_position v0
    dcl_texcoord v1

def c220, 0, 3, 0.0625, 0.5
dcl_2d s0

texldl r31, c220.z, s0

    mov r0.zw, c8.x
    mov r0.xy, v1
    dp4 r21.y, r0, c5
    dp4 r21.x, r0, c4
    dp4 o0.w, v0, c3
    dp4 o0.z, v0, c2
    dp4 o0.y, v0, c1
    dp4 o0.x, v0, c0

// Approximately fixed the broken part of the shadow, but broke other things as well
// With convergence = 0 shadows are completely fixed... except for a couple of
// rocks that are now broken (sigh)
add r31.w, v0.w, -r31.y // Used v0.w since r21.w is undefined
mul r31.w, r31.w, r31.x
mul r31.w, r31.w, c220.w
add r21.x, r21.x, -r31.w

mov o1.xy, r21.xy
