//shadow in Wilbur's room

    ps_3_0
    dcl_2d s0
    dcl_2d s1
    def c8, -0.00999999978, 0, 1, 255
    def c9, 0.00392156979, 0, 0, 0
    dcl_texcoord v0.xyz
    dcl_texcoord1 v1.xyz
    dcl_texcoord2 v2.xyz
    dcl_texcoord3 v3.xyz
    dcl_texcoord4 v4
    dcl_texcoord5 v5.xy

def c220, 0, 1, 0.0625, 0

    texld r1, v5, s0
    add r0.xyz, v4, -c1
    add r2.xyz, v4, -c4
    dp3 r0.x, r0, r0
    add r1.xyz, v4, -c2
    dp3 r0.y, r1, r1
    add r1.xyz, v4, -c3
    dp3 r0.z, r1, r1
    dp3 r0.w, r2, r2
    add r0, r0, -c5
    cmp r0, r0, c8.y, c8.z
    mov r1.x, r0.y
    mov r1.z, r0.w
    mov r1.y, r0.z
    add_sat r1.xyz, r1, -r0
    mul r2.xyz, r1.x, v1
    mad r2.xyz, r0.x, v0, r2
    add r0.x, r1.w, c8
    mad r2.xyz, r1.y, v2, r2
    mad r2.xyz, v3, r1.z, r2
    cmp r0.x, r0, c8.y, c8.z
    mov_pp r1, -r0.x
    mov r3.y, c8.w
    mov r3.x, c8.z
    texld r0, r2, s1
    texkill r1
    add r2.xyz, -v4, c7
    mov r1.x, c6
    add r1.x, c8.z, -r1
    dp3 r2.x, r2, r2
    mad r0.x, r0, r1, c6
    rsq r1.x, r2.x
    mul r2.x, -v4.w, c0.w
    rcp r1.x, r1.x
    mad_sat r1.x, r1, c6.z, c6.w
    add r2.x, r2, c8.z
    mul r2.xy, r2.x, r3
    frc r2.xy, r2
    add_sat r0.x, r0, r1
    mov r1.y, r2
    mad r1.x, -r2.y, c9, r2
    mov r0.w, r1.y
    mov r0.z, r1.x
    mov r0.y, c8.z
    mov_pp oC0, r0

// Optionally disable broken shadows. Need to output (1,1,1,1) as 0 will put
// the whole scene into darkness.
mov r13.x, c200.x
if_eq r13.x, c220.x
mov oC0, c220.yyyy
endif
