// Water far out towards horizon

//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float fresnel_zero;
//   float ripple_scale;
//   float water_density;
//
//
// Registers:
//
//   Name          Reg   Size
//   ------------- ----- ----
//   water_density c0       1
//   ripple_scale  c1       1
//   fresnel_zero  c2       1
//
//
// Default values:
//
//   water_density
//     c0   = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c1   = { 0.03, 0, 0, 0 };
//
//   fresnel_zero
//     c2   = { 0, 0, 0, 0 };
//

//PRESHADER     preshader
//PRESHADER     rcp c15.x, c1.x
//PRESHADER     log r0.x, c0.x
//PRESHADER     mul c16.x, r0.x, (0.693147181)
//PRESHADER     neg r0.x, c2.x
//PRESHADER     add c25.x, r0.x, (1)

// approximately 5 instructions used
//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float4 cloud_map_blend;
//   float4 fog_color;
//   float3 fog_params;
//   float fresnel_zero;
//   float4 light_ambient;
//   float4 light_color;
//   float3 light_dir;
//   float4 lod_dir;
//   float4 lod_pos;
//   sampler2D noise_sampler;
//   float normal_z;
//   sampler2D refl_sampler;
//   sampler2D refr_sampler;
//   float refract_scale;
//   float3x3 refract_xform;
//   float refractive_index;
//   float ripple_height;
//   float ripple_scale;
//   float shadow_fades[2];
//   float3 shadow_hd_center;
//   float3 shadow_hd_xaxis;
//   float3 shadow_hd_yaxis;
//   float4x4 shadow_mats[4];
//   float4 shadow_res_invres;
//   sampler2D shadow_sampler;
//   float2 shadow_zbias;
//   float4 water_color;
//   float water_density;
//   float4 water_filter;
//   sampler2D waves_sampler;
//
//
// Registers:
//
//   Name              Reg   Size
//   ----------------- ----- ----
//   shadow_mats       c0      15
//   refract_xform     c26      3
//   shadow_fades      c29      2
//   shadow_res_invres c31      1
//   shadow_zbias      c32      1
//   shadow_hd_center  c33      1
//   shadow_hd_xaxis   c34      1
//   shadow_hd_yaxis   c35      1
//   lod_pos           c36      1
//   lod_dir           c37      1
//   light_ambient     c38      1
//   light_dir         c39      1
//   fog_color         c40      1
//   fog_params        c41      1
//   cloud_map_blend   c42      1
//   light_color       c43      1
//   water_color       c44      1
//   water_filter      c45      1
//   water_density     c46      1
//   ripple_scale      c47      1
//   ripple_height     c48      1
//   refractive_index  c49      1
//   refract_scale     c50      1
//   fresnel_zero      c51      1
//   normal_z          c52      1
//   refl_sampler      s0       1
//   waves_sampler     s1       1
//   refr_sampler      s2       1
//   shadow_sampler    s3       1
//   noise_sampler     s4       1
//
//
// Default values:
//
//   shadow_mats
//     c0   = { 0, 0, 0, 0 };
//     c1   = { 0, 0, 0, 0 };
//     c2   = { 0, 0, 0, 0 };
//     c3   = { 0, 0, 0, 0 };
//     c4   = { 0, 0, 0, 0 };
//     c5   = { 0, 0, 0, 0 };
//     c6   = { 0, 0, 0, 0 };
//     c7   = { 0, 0, 0, 0 };
//     c8   = { 0, 0, 0, 0 };
//     c9   = { 0, 0, 0, 0 };
//     c10  = { 0, 0, 0, 0 };
//     c11  = { 0, 0, 0, 0 };
//     c12  = { 0, 0, 0, 0 };
//     c13  = { 0, 0, 0, 0 };
//     c14  = { 0, 0, 0, 0 };
//
//   refract_xform
//     c26  = { 0, 0, 0, 0 };
//     c27  = { 0, 0, 0, 0 };
//     c28  = { 0, 0, 0, 0 };
//
//   shadow_fades
//     c29  = { 0, 0, 0, 0 };
//     c30  = { 0, 0, 0, 0 };
//
//   shadow_res_invres
//     c31  = { 0, 0, 0, 0 };
//
//   shadow_zbias
//     c32  = { 0, 0, 0, 0 };
//
//   shadow_hd_center
//     c33  = { 0, 0, 0, 0 };
//
//   shadow_hd_xaxis
//     c34  = { 0, 0, 0, 0 };
//
//   shadow_hd_yaxis
//     c35  = { 0, 0, 0, 0 };
//
//   lod_pos
//     c36  = { 0, 0, 0, 0 };
//
//   lod_dir
//     c37  = { 0, 0, 0, 0 };
//
//   light_ambient
//     c38  = { 0, 0, 0, 0 };
//
//   light_dir
//     c39  = { 0, 0, 0, 0 };
//
//   fog_color
//     c40  = { 0, 0, 0, 0 };
//
//   fog_params
//     c41  = { 0, 0, 0, 0 };
//
//   cloud_map_blend
//     c42  = { 0, 0, 0, 0 };
//
//   light_color
//     c43  = { 0, 0, 0, 0 };
//
//   water_color
//     c44  = { 0.015, 0.01, 0.005, 0 };
//
//   water_filter
//     c45  = { 0.05, 0.01, 0.002, 0 };
//
//   water_density
//     c46  = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c47  = { 0.03, 0, 0, 0 };
//
//   ripple_height
//     c48  = { 0.5, 0, 0, 0 };
//
//   refractive_index
//     c49  = { 1, 0, 0, 0 };
//
//   refract_scale
//     c50  = { 0.05, 0, 0, 0 };
//
//   fresnel_zero
//     c51  = { 0, 0, 0, 0 };
//
//   normal_z
//     c52  = { 1, 0, 0, 0 };
//

    ps_3_0
    def c53, -0.00999999978, 0.00999999978, 1, 0.5
    def c54, 2, -1, 1, 64
    def c55, -0.015625, 256, 0, 1.44269502
    def c56, 0.0199999996, 0, 1, 4
    def c57, 0, 0.5, 0.111111112, 0
    dcl_texcoord v0.xyz
    dcl_texcoord2 v1.xyw
    dcl_texcoord3 v2
    dcl_2d s0
    dcl_2d s1
    dcl_2d s2
    dcl_2d s3
    dcl_2d s4

dcl_texcoord5 v5 // New input with corrected world coordinates

    add r0.x, c36.z, -v0.z // Using uncorrected coordinate here does better for black seam when camera is tilted. A seam is still visible, but no longer black
    add r0, r0.x, c53.x
    texkill r0
    mov r0.w, c53.z
    add r1.xyz, -c36, v5 // Use corrected world position
    rcp r1.w, r1.z
    mul r1.w, r1.w, -c36.z
    mul r1.xyz, r1.w, r1
    lrp r2.xyz, r1.w, v0, c36 // Use uncorrected world position - blends a little better at the edge of the map (still not great)
    dp3 r1.w, r1, r1
    rsq r1.w, r1.w
    rcp r3.x, r1.w
    mul r3.x, r3.x, c53.y
    max r4.x, c53.z, r3.x
    rcp r3.x, r4.x
    mul r4.z, r4.x, c52.x
    mul r3.x, r3.x, c48.x
    mul r3.yzw, r1.w, r1.xxyz
    mul r5.xy, r3.x, r3.yzzw
    mul r5.zw, r2.xyxy, c47.x
    texld r6, r5.zwzw, s1
    mad r6.xz, r6.y, r5.xyyw, r5.zyww
    texld r7, r6.xzzw, s1
    add r3.x, r6.y, r7.y
    mul r3.x, r3.x, c53.w
    mad r5.xy, r3.x, r5, r5.zwzw
    mul r2.xy, r5, c15.x
    texld r5, r5, s1
    mad r4.xy, r5.zwzw, c54.x, c54.y
    nrm r5.xyz, r4
    add r4.xyz, r2, -c33
    dp3 r3.x, r4, c34
    dp3 r4.x, r4, c35
    add r4.x, -r4_abs.x, c53.z
    cmp r4.x, r4.x, c56.y, c56.z
    add r3.x, -r3_abs.x, c53.z
    cmp r3.x, r3.x, c56.y, c56.z
    add r3.x, r4.x, r3.x
    cmp r4, -r3.x, c57.xxxy, c57.yxyy
    mov r6, c4
    cmp r6, -r3.x, r6, c12
    mov r2.w, c53.z
    dp4_sat r6.x, r2, r6
    mov r7, c5
    cmp r7, -r3.x, r7, c13
    dp4_sat r6.y, r2, r7
    mad r4.zw, r6.xyxy, c53.w, r4
    mov r6.zw, c53
    mad r7, r4.zzww, c31.xxyy, -r6.w
    frc r7, r7
    mad r8, r7, c54.yzyz, c54.xzxz
    mad r7.xy, r7.ywzw, -c31.zwzw, r4.zwzw
    rcp r9.y, r8.z
    rcp r9.x, r8.x
    rcp r9.z, r8.y
    mad r10.xyz, r9, c54.zzyw, c54.yyxw
    mul r10.xyz, r10, c31.zwzw
    mov r11, c6
    cmp r11, -r3.x, r11, c14
    dp4 r4.z, r2, r11
    texldp r11, v2, s4
    mad r4.w, r11.w, c32.y, c32.x
    mul r5.w, r4.w, c56.w
    cmp r4.w, -r3.x, r4.w, r5.w
    add r7.z, r4.w, r4.z
    mov r10.w, c55.z
    add r0.xyz, r7, r10.xyww
    add r10.xyz, r7, r10.zyww
    texldp r0, r0, s3
    mov r10.w, c53.z
    texldp r10, r10, s3
    mov r0.y, r10.x
    rcp r9.w, r8.w
    mul r8, r8.zzww, r8.xyyx
    mad r9.xyz, r9.zwxw, c54.yyzw, c54.xxyw
    mul r9.xyz, r9, c31.zwzw
    mov r9.w, c55.z
    add r10.xyz, r7, r9.xyww
    add r7.xyz, r7, r9.zyww
    mov r10.w, c53.z
    texldp r9, r10, s3
    mov r0.z, r9.x
    mov r7.w, c53.z
    texldp r7, r7, s3
    mov r0.w, r7.x
    dp4 r0.x, r8, r0
    mov r7, c0
    cmp r7, -r3.x, r7, c8
    dp4_sat r6.x, r2, r7
    mov r7, c1
    cmp r7, -r3.x, r7, c9
    dp4_sat r6.y, r2, r7
    mad r0.yz, r6.xxyw, c53.w, r4.xxyw
    mad r7, r0.yyzz, c31.xxyy, -r6.w
    frc r7, r7
    mad r4.xy, r7.ywzw, -c31.zwzw, r0.yzzw
    mad r7, r7, c54.yzyz, c54.xzxz
    rcp r8.y, r7.z
    rcp r8.x, r7.x
    rcp r8.z, r7.y
    mad r0.yzw, r8.xxyz, c54.xzzy, c54.xyyx
    mul r9.xyz, r0.yzww, c31.zwzw
    mov r10, c2
    cmp r10, -r3.x, r10, c10
    mov r6.x, c29.x
    cmp r0.y, -r3.x, r6.x, c30.x
    dp4 r0.z, r2, r10
    add r2.xyz, r2, -c36
    add r4.z, r4.w, r0.z
    mov r9.w, c55.z
    add r10.xyz, r4, r9.xyww
    add r9.xyz, r4, r9.zyww
    mov r10.w, c53.z
    texldp r10, r10, s3
    mov r9.w, c53.z
    texldp r9, r9, s3
    mov r10.y, r9.x
    rcp r8.w, r7.w
    mul r7, r7.zzww, r7.xyyx
    mad r6.xyw, r8.zwzx, c54.yyzz, c54.xxzy
    mul r8.xyz, r6.xyww, c31.zwzw
    mov r8.w, c55.z
    add r9.xyz, r4, r8.xyww
    add r4.xyz, r4, r8.zyww
    mov r9.w, c53.z
    texldp r8, r9, s3
    mov r10.z, r8.x
    mov r4.w, c53.z
    texldp r4, r4, s3
    mov r10.w, r4.x
    dp4 r0.z, r7, r10
    mul r0.z, r0.z, c57.z
    mad r0.x, r0.x, c57.z, -r0.z
    mad r0.x, r0.y, r0.x, r0.z
    mov r3.x, c42.x
    mad r0.x, r0.x, r3.x, c38.x
    dp3 r0.y, r3.yzww, r5
    mul r3.xyz, r3.yzww, c54.yyzw
    mul r4.xyz, r0.y, r5
    add r0.y, r0.y, c53.z
    mad r6.xyw, r1.xyzz, r1.w, -r4.xyzz
    mad r4.xyz, r6.xyww, c49.x, r4
    dp3 r0.z, r4, r5
    cmp r0.z, r0.z, c55.z, -r0.z
    dp3 r0.w, r1, c37
    max r1.x, c56.x, r0.z
    dp3 r1.y, c39, r5
    max r2.w, r1.y, c55.z
    add r1.y, r1.x, r2.w
    mul r1.z, r1.x, r2.w
    rcp r1.z, r1.z
    mul r1.y, r1.y, c16.x
    mul r1.y, r1.z, r1.y
    mul r1.x, r1.y, r1.x
    rcp r1.x, r1.x
    add r1.z, r0.w, c55.y
    rcp r1.w, v1.w
    mul r4.xy, r1.w, v1
    texld r7, r4, s2
    mul r1.w, r7.w, c54.w
    add r2.w, r7.w, c55.x
    cmp r1.z, r2.w, r1.w, r1.z
    add r1.z, -r0.w, r1.z
    max r2.w, r1.z, c55.z
    mul r0.z, r0.z, r2.w
    mul r0.z, r1.y, r0.z
    mul r0.z, r0.z, c55.w
    exp r0.z, r0.z
    add r0.z, r0.z, -c53.z
    mul r0.z, r0.z, c46.x
    mul r0.z, r1.x, r0.z
    mul r1.xyz, r0.z, c44
    mul r1.xyz, r1, c43
    mov_sat r0.z, r2.w
    mul r0.z, r0.z, c50.x
    mad r4.xy, r5, r0.z, r4
    texld r4, r4, s2
    mad r0.z, r4.w, c54.w, -r0.w
    cmp r4.xyz, r0.z, r4, r7
    mul oC0.w, r0.w, -c55.x
    mad_sat r6.xyz, r2.w, -c45, r6.z
    mul r0.z, r2.w, c16.x
    mul r0.z, r0.z, c55.w
    exp r0.z, r0.z
    mul r4.xyz, r4, r6
    mad r1.xyz, r4, r0.z, r1
    dp3 r0.z, r3, r5
    add r0.z, r0.z, r0.z
    mad r3.xyz, r5, -r0.z, r3
    dp3 r4.x, r3, c26
    dp3 r4.y, r3, c27
    dp3 r0.z, r3, c28
    add r0.z, r0.z, r0.z
    rcp r0.z, r0.z
    mad r0.zw, r4.xyxy, r0.z, c53.w
    texld r3, r0.zwzw, s0
    mad r3.xyz, r1, -r0.x, r3
    mul r0.xzw, r0.x, r1.xyyz
    mul r1.x, r0.y, r0.y
    mul r1.x, r1.x, r1.x
    mul r0.y, r0.y, r1.x
    mov r1.x, c25.x
    mad r0.y, r1.x, r0.y, c51.x
    mad r0.xyz, r0.y, r3, r0.xzww
    add r0.xyz, r0, -c40
    mul r0.w, r2.z, c41.y
    mul r1.x, r0.w, -c55.w
    rcp r0.w, r0.w
    exp r1.x, r1.x
    add r1.x, -r1.x, c53.z
    mul r0.w, r0.w, r1.x
    dp3 r1.x, r2, r2
    add r1.y, -r2_abs.z, c53.y
    rsq r1.x, r1.x
    rcp r1.x, r1.x
    mul r1.x, r1.x, c41.z
    mul r0.w, r0.w, r1.x
    cmp r0.w, r1.y, r1.x, r0.w
    mul r0.w, r0.w, -c41.x
    mul r0.w, r0.w, c55.w
    exp r0.w, r0.w
    mad oC0.xyz, r0.w, r0, c40

// approximately 224 instruction slots used (15 texture, 209 arithmetic)
