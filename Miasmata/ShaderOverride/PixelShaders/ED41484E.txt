// Water (medium/high water, with low quality shadow filtering)

//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float fresnel_zero;
//   float ripple_scale;
//   float water_density;
//
//
// Registers:
//
//   Name          Reg   Size
//   ------------- ----- ----
//   water_density c0       1
//   ripple_scale  c1       1
//   fresnel_zero  c2       1
//
//
// Default values:
//
//   water_density
//     c0   = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c1   = { 0.03, 0, 0, 0 };
//
//   fresnel_zero
//     c2   = { 0, 0, 0, 0 };
//

//PRESHADER     preshader
//PRESHADER     rcp c18.x, c1.x
//PRESHADER     log r0.x, c0.x
//PRESHADER     mul c19.x, r0.x, (0.693147181)
//PRESHADER     neg r0.x, c2.x
//PRESHADER     add c20.x, r0.x, (1)

// approximately 5 instructions used
//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float4 cloud_map_blend;
//   float4 fog_color;
//   float3 fog_params;
//   float fresnel_zero;
//   float4 light_ambient;
//   float4 light_color;
//   float3 light_dir;
//   float4 lod_dir;
//   float4 lod_pos;
//   sampler2D noise_sampler;
//   float normal_z;
//   sampler2D refl_sampler;
//   sampler2D refr_sampler;
//   float refract_scale;
//   float3x3 refract_xform;
//   float refractive_index;
//   float ripple_height;
//   float ripple_scale;
//   float shadow_fades[2];
//   float3 shadow_hd_center;
//   float3 shadow_hd_xaxis;
//   float3 shadow_hd_yaxis;
//   float4x4 shadow_mats[4];
//   sampler2D shadow_sampler;
//   float2 shadow_zbias;
//   sampler2D surface_sampler;
//   float4 water_color;
//   float water_density;
//   float4 water_filter;
//   sampler2D waves_sampler;
//
//
// Registers:
//
//   Name             Reg   Size
//   ---------------- ----- ----
//   shadow_mats      c0      15
//   refract_xform    c15      3
//   shadow_fades     c21      2
//   shadow_zbias     c23      1
//   shadow_hd_center c24      1
//   shadow_hd_xaxis  c25      1
//   shadow_hd_yaxis  c26      1
//   lod_pos          c27      1
//   lod_dir          c28      1
//   light_ambient    c29      1
//   light_dir        c30      1
//   fog_color        c31      1
//   fog_params       c32      1
//   cloud_map_blend  c33      1
//   light_color      c34      1
//   water_color      c35      1
//   water_filter     c36      1
//   water_density    c37      1
//   ripple_scale     c38      1
//   ripple_height    c39      1
//   refractive_index c40      1
//   refract_scale    c41      1
//   fresnel_zero     c42      1
//   normal_z         c43      1
//   refl_sampler     s0       1
//   waves_sampler    s1       1
//   surface_sampler  s2       1
//   refr_sampler     s3       1
//   shadow_sampler   s4       1
//   noise_sampler    s5       1
//
//
// Default values:
//
//   shadow_mats
//     c0   = { 0, 0, 0, 0 };
//     c1   = { 0, 0, 0, 0 };
//     c2   = { 0, 0, 0, 0 };
//     c3   = { 0, 0, 0, 0 };
//     c4   = { 0, 0, 0, 0 };
//     c5   = { 0, 0, 0, 0 };
//     c6   = { 0, 0, 0, 0 };
//     c7   = { 0, 0, 0, 0 };
//     c8   = { 0, 0, 0, 0 };
//     c9   = { 0, 0, 0, 0 };
//     c10  = { 0, 0, 0, 0 };
//     c11  = { 0, 0, 0, 0 };
//     c12  = { 0, 0, 0, 0 };
//     c13  = { 0, 0, 0, 0 };
//     c14  = { 0, 0, 0, 0 };
//
//   refract_xform
//     c15  = { 0, 0, 0, 0 };
//     c16  = { 0, 0, 0, 0 };
//     c17  = { 0, 0, 0, 0 };
//
//   shadow_fades
//     c21  = { 0, 0, 0, 0 };
//     c22  = { 0, 0, 0, 0 };
//
//   shadow_zbias
//     c23  = { 0, 0, 0, 0 };
//
//   shadow_hd_center
//     c24  = { 0, 0, 0, 0 };
//
//   shadow_hd_xaxis
//     c25  = { 0, 0, 0, 0 };
//
//   shadow_hd_yaxis
//     c26  = { 0, 0, 0, 0 };
//
//   lod_pos
//     c27  = { 0, 0, 0, 0 };
//
//   lod_dir
//     c28  = { 0, 0, 0, 0 };
//
//   light_ambient
//     c29  = { 0, 0, 0, 0 };
//
//   light_dir
//     c30  = { 0, 0, 0, 0 };
//
//   fog_color
//     c31  = { 0, 0, 0, 0 };
//
//   fog_params
//     c32  = { 0, 0, 0, 0 };
//
//   cloud_map_blend
//     c33  = { 0, 0, 0, 0 };
//
//   light_color
//     c34  = { 0, 0, 0, 0 };
//
//   water_color
//     c35  = { 0.015, 0.01, 0.005, 0 };
//
//   water_filter
//     c36  = { 0.05, 0.01, 0.002, 0 };
//
//   water_density
//     c37  = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c38  = { 0.03, 0, 0, 0 };
//
//   ripple_height
//     c39  = { 0.5, 0, 0, 0 };
//
//   refractive_index
//     c40  = { 1, 0, 0, 0 };
//
//   refract_scale
//     c41  = { 0.05, 0, 0, 0 };
//
//   fresnel_zero
//     c42  = { 0, 0, 0, 0 };
//
//   normal_z
//     c43  = { 1, 0, 0, 0 };
//

    ps_3_0
    def c44, 0.00999999978, 1, 0.5, -2
    def c45, -1, 1, 64, -0.015625
    def c46, 256, 0, 0.25, 1.44269502
    def c47, 0.0199999996, 0, 1, 4
    def c48, 0, 0.5, 8, 5
    dcl_texcoord v0.xyz
    dcl_texcoord2 v1.xyw
    dcl_texcoord3 v2
    dcl_2d s0
    dcl_2d s1
    dcl_2d s2
    dcl_2d s3
    dcl_2d s4
    dcl_2d s5

dcl_texcoord5 v5 // New input with corrected world coordinates

// We need to use both corrected and uncorrected wold positions here. The
// corrected position will fix the reflections, but we need the uncorrected
// position for the shadows & ripples. Interleave instructions using corrected
// and uncorrected for the first part of this shader until we no longer need
// the uncorrected version.

    add r0.xyz, -c27, v5 // Changed to use corrected world position from vertex shader
add r20.xyz, -c27, v0 // Uncorrected world position, which we need for shadows
    dp3 r0.w, r0, r0
dp3 r20.w, r20, r20
    rsq r0.w, r0.w
rsq r20.w, r20.w
    rcp r1.x, r0.w
rcp r21.x, r20.w
    mul r1.x, r1.x, c44.x
mul r21.x, r21.x, c44.x
    max r2.x, c44.y, r1.x
max r22.x, c44.y, r21.x
    rcp r1.x, r2.x
rcp r21.x, r22.x
    mul r2.z, r2.x, c43.x
mul r22.z, r22.x, c43.x
    mul r1.x, r1.x, c39.x
mul r21.x, r21.x, c39.x
    mul r1.yzw, r0.w, r0.xxyz
mul r21.yzw, r20.w, r20.xxyz
    // mul r3.xy, r1.x, r1.yzzw // Needs original world position...
mul r3.xy, r21.x, r21.yzzw // ...like this
    mul r3.zw, c38.x, v0.xyxy // Original world position (corrected position breaks shadows & ripples)
    texld r4, r3.zwzw, s1
    mad r4.xz, r4.y, r3.xyyw, r3.zyww
    texld r5, r4.xzzw, s1
    add r1.x, r4.y, r5.y
    mul r1.x, r1.x, c44.z
    mad r3.xy, r1.x, r3, r3.zwzw
    texld r4, r3, s1
    add r1.x, r4.x, -c44.y
    mad r2.xy, r4.zwzw, -c44.w, -c44.y
    nrm r4.xyz, r2
    rcp r2.x, v1.w
    mul r2.xy, r2.x, v1
    texld r5, r2, s3
    mul r2.z, r5.w, c45.z
    add r2.w, r5.w, c45.w
    dp3 r3.z, r0, c28
    add r3.w, r3.z, c46.x
    cmp r2.z, r2.w, r2.z, r3.w
    add r2.z, -r3.z, r2.z
    max r3.w, r2.z, c46.y
    mad r6, r1.x, c46.z, r3.w
    add r1.x, r6.w, -c44.z
    add r1.x, -r1_abs.x, c44.z
    mul_sat r1.x, r1.x, c48.w
    texkill r6
    dp3 r2.z, r1.yzww, r4
    mul r1.yzw, r1, c45.xxxy
    mul r6.xyz, r2.z, r4
    add r2.z, r2.z, c44.y
    mad r0.xyz, r0, r0.w, -r6
    mad r0.xyz, r0, c40.x, r6
    dp3 r0.x, r0, r4
    cmp r0.x, r0.x, c46.y, -r0.x
    max r2.w, c47.x, r0.x
    mul r0.x, r0.x, r3.w
    dp3 r0.y, c30, r4
    max r4.w, r0.y, c46.y
    add r0.y, r2.w, r4.w
    mul r0.z, r2.w, r4.w
    rcp r0.z, r0.z
    mul r0.y, r0.y, c19.x
    mul r0.y, r0.z, r0.y
    mul r0.z, r0.y, r2.w
    mul r0.x, r0.y, r0.x
    mul r0.x, r0.x, c46.w
    exp r0.x, r0.x
    add r0.x, r0.x, -c44.y
    mul r0.x, r0.x, c37.x
    rcp r0.y, r0.z
    mul r0.x, r0.y, r0.x
    mul r0.xyz, r0.x, c35
    mul r0.xyz, r0, c34
    mov_sat r0.w, r3.w
    mul r0.w, r0.w, c41.x
    mad r2.xy, r4, r0.w, r2
    texld r6, r2, s3
    mad r0.w, r6.w, c45.z, -r3.z
    cmp r2.xyw, r0.w, r6.xyzz, r5.xyzz
    mul oC0.w, r3.z, -c45.w
    mov r5.y, c44.y
    mad_sat r5.xyz, r3.w, -c36, r5.y
    mul r0.w, r3.w, c19.x
    mul r0.w, r0.w, c46.w
    exp r0.w, r0.w
    mul r2.xyw, r2, r5.xyzz
    mad r0.xyz, r2.xyww, r0.w, r0
    mul r2.xy, r3, c48.z
    mul r3.xy, r3, c18.x
    texld r5, r2, s2
    mul r2.xyw, r5.xyzz, c46.z
    add r0.w, r5.x, c44.w
    mul r2.xyw, r1.x, r2
    cmp r2.xyw, r0.w, r2, c46.y
    add r0.xyz, r0, r2.xyww
    mov r5.w, c44.y
    mov r3.z, v5.z
    add r2.xyw, r3.xyzz, -c24.xyzz
    dp3 r0.w, r2.xyww, c25
    dp3 r1.x, r2.xyww, c26
    add r1.x, -r1_abs.x, c44.y
    cmp r1.x, r1.x, c47.y, c47.z
    add r0.w, -r0_abs.w, c44.y
    cmp r0.w, r0.w, c47.y, c47.z
    add r0.w, r1.x, r0.w
    mov r6, c0
    cmp r6, -r0.w, r6, c8
    mov r3.w, c44.y
    dp4_sat r2.x, r3, r6
    mov r6, c1
    cmp r6, -r0.w, r6, c9
    dp4_sat r2.y, r3, r6
    cmp r6, -r0.w, c48.xxxy, c48.yxyy
    mad r5.xy, r2, c44.z, r6
    mov r7, c2
    cmp r7, -r0.w, r7, c10
    dp4 r1.x, r3, r7
    texldp r7, v2, s5
    mad r2.x, r7.w, c23.y, c23.x
    mul r2.y, r2.x, c47.w
    cmp r2.x, -r0.w, r2.x, r2.y
    add r5.z, r1.x, r2.x
    texldp r5, r5, s4
    mov r7, c4
    cmp r7, -r0.w, r7, c12
    dp4_sat r5.x, r3, r7
    mov r7, c5
    cmp r7, -r0.w, r7, c13
    dp4_sat r5.y, r3, r7
    mad r6.xy, r5, c44.z, r6.zwzw
    mov r7, c6
    cmp r7, -r0.w, r7, c14
    mov r1.x, c21.x
    cmp r0.w, -r0.w, r1.x, c22.x
    dp4 r1.x, r3, r7
    add r3.xyz, r3, -c27
    add r6.z, r2.x, r1.x
    mov r6.w, c44.y
    texldp r6, r6, s4
    lrp r1.x, r0.w, r6.w, r5.w
    mov r2.x, c33.x
    mad r0.w, r1.x, r2.x, c29.x
    dp3 r1.x, r1.yzww, r4
    add r1.x, r1.x, r1.x
    mad r1.xyz, r4, -r1.x, r1.yzww
    dp3 r2.x, r1, c15
    dp3 r2.y, r1, c16
    dp3 r1.x, r1, c17
    add r1.x, r1.x, r1.x
    rcp r1.x, r1.x
    mad r1.xy, r2, r1.x, c44.z
    texld r1, r1, s0
    mad r1.xyz, r0, -r0.w, r1
    mul r0.xyz, r0.w, r0
    mul r0.w, r2.z, r2.z
    mul r0.w, r0.w, r0.w
    mul r0.w, r0.w, r2.z
    mov r2.x, c20.x
    mad r0.w, r2.x, r0.w, c42.x
    mad r0.xyz, r0.w, r1, r0
    add r0.xyz, r0, -c31
    mul r0.w, r3.z, c32.y
    mul r1.x, r0.w, -c46.w
    rcp r0.w, r0.w
    exp r1.x, r1.x
    add r1.x, -r1.x, c44.y
    mul r0.w, r0.w, r1.x
    dp3 r1.x, r3, r3
    add r1.y, -r3_abs.z, c44.x
    rsq r1.x, r1.x
    rcp r1.x, r1.x
    mul r1.x, r1.x, c32.z
    mul r0.w, r0.w, r1.x
    cmp r0.w, r1.y, r1.x, r0.w
    mul r0.w, r0.w, -c32.x
    mul r0.w, r0.w, c46.w
    exp r0.w, r0.w
    mad oC0.xyz, r0.w, r0, c31

// approximately 171 instruction slots used (10 texture, 161 arithmetic)

