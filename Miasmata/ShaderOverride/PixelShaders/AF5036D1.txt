// Medium/High water at edge of map with low quality shadow filtering

//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float fresnel_zero;
//   float ripple_scale;
//   float water_density;
//
//
// Registers:
//
//   Name          Reg   Size
//   ------------- ----- ----
//   water_density c0       1
//   ripple_scale  c1       1
//   fresnel_zero  c2       1
//
//
// Default values:
//
//   water_density
//     c0   = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c1   = { 0.03, 0, 0, 0 };
//
//   fresnel_zero
//     c2   = { 0, 0, 0, 0 };
//

//PRESHADER     preshader
//PRESHADER     rcp c18.x, c1.x
//PRESHADER     log r0.x, c0.x
//PRESHADER     mul c19.x, r0.x, (0.693147181)
//PRESHADER     neg r0.x, c2.x
//PRESHADER     add c20.x, r0.x, (1)

// approximately 5 instructions used
//
// Generated by Microsoft (R) HLSL Shader Compiler 9.29.952.3111
//
// Parameters:
//
//   float4 cloud_map_blend;
//   float4 fog_color;
//   float3 fog_params;
//   float fresnel_zero;
//   float4 light_ambient;
//   float4 light_color;
//   float3 light_dir;
//   float4 lod_dir;
//   float4 lod_pos;
//   sampler2D noise_sampler;
//   float normal_z;
//   sampler2D refl_sampler;
//   sampler2D refr_sampler;
//   float refract_scale;
//   float3x3 refract_xform;
//   float refractive_index;
//   float ripple_height;
//   float ripple_scale;
//   float shadow_fades[2];
//   float3 shadow_hd_center;
//   float3 shadow_hd_xaxis;
//   float3 shadow_hd_yaxis;
//   float4x4 shadow_mats[4];
//   sampler2D shadow_sampler;
//   float2 shadow_zbias;
//   float4 water_color;
//   float water_density;
//   float4 water_filter;
//   sampler2D waves_sampler;
//
//
// Registers:
//
//   Name             Reg   Size
//   ---------------- ----- ----
//   shadow_mats      c0      15
//   refract_xform    c15      3
//   shadow_fades     c21      2
//   shadow_zbias     c23      1
//   shadow_hd_center c24      1
//   shadow_hd_xaxis  c25      1
//   shadow_hd_yaxis  c26      1
//   lod_pos          c27      1
//   lod_dir          c28      1
//   light_ambient    c29      1
//   light_dir        c30      1
//   fog_color        c31      1
//   fog_params       c32      1
//   cloud_map_blend  c33      1
//   light_color      c34      1
//   water_color      c35      1
//   water_filter     c36      1
//   water_density    c37      1
//   ripple_scale     c38      1
//   ripple_height    c39      1
//   refractive_index c40      1
//   refract_scale    c41      1
//   fresnel_zero     c42      1
//   normal_z         c43      1
//   refl_sampler     s0       1
//   waves_sampler    s1       1
//   refr_sampler     s2       1
//   shadow_sampler   s3       1
//   noise_sampler    s4       1
//
//
// Default values:
//
//   shadow_mats
//     c0   = { 0, 0, 0, 0 };
//     c1   = { 0, 0, 0, 0 };
//     c2   = { 0, 0, 0, 0 };
//     c3   = { 0, 0, 0, 0 };
//     c4   = { 0, 0, 0, 0 };
//     c5   = { 0, 0, 0, 0 };
//     c6   = { 0, 0, 0, 0 };
//     c7   = { 0, 0, 0, 0 };
//     c8   = { 0, 0, 0, 0 };
//     c9   = { 0, 0, 0, 0 };
//     c10  = { 0, 0, 0, 0 };
//     c11  = { 0, 0, 0, 0 };
//     c12  = { 0, 0, 0, 0 };
//     c13  = { 0, 0, 0, 0 };
//     c14  = { 0, 0, 0, 0 };
//
//   refract_xform
//     c15  = { 0, 0, 0, 0 };
//     c16  = { 0, 0, 0, 0 };
//     c17  = { 0, 0, 0, 0 };
//
//   shadow_fades
//     c21  = { 0, 0, 0, 0 };
//     c22  = { 0, 0, 0, 0 };
//
//   shadow_zbias
//     c23  = { 0, 0, 0, 0 };
//
//   shadow_hd_center
//     c24  = { 0, 0, 0, 0 };
//
//   shadow_hd_xaxis
//     c25  = { 0, 0, 0, 0 };
//
//   shadow_hd_yaxis
//     c26  = { 0, 0, 0, 0 };
//
//   lod_pos
//     c27  = { 0, 0, 0, 0 };
//
//   lod_dir
//     c28  = { 0, 0, 0, 0 };
//
//   light_ambient
//     c29  = { 0, 0, 0, 0 };
//
//   light_dir
//     c30  = { 0, 0, 0, 0 };
//
//   fog_color
//     c31  = { 0, 0, 0, 0 };
//
//   fog_params
//     c32  = { 0, 0, 0, 0 };
//
//   cloud_map_blend
//     c33  = { 0, 0, 0, 0 };
//
//   light_color
//     c34  = { 0, 0, 0, 0 };
//
//   water_color
//     c35  = { 0.015, 0.01, 0.005, 0 };
//
//   water_filter
//     c36  = { 0.05, 0.01, 0.002, 0 };
//
//   water_density
//     c37  = { 0.9, 0, 0, 0 };
//
//   ripple_scale
//     c38  = { 0.03, 0, 0, 0 };
//
//   ripple_height
//     c39  = { 0.5, 0, 0, 0 };
//
//   refractive_index
//     c40  = { 1, 0, 0, 0 };
//
//   refract_scale
//     c41  = { 0.05, 0, 0, 0 };
//
//   fresnel_zero
//     c42  = { 0, 0, 0, 0 };
//
//   normal_z
//     c43  = { 1, 0, 0, 0 };
//

    ps_3_0
    def c44, -0.00999999978, 0.00999999978, 1, 0.5
    def c45, 2, -1, 1, 64
    def c46, -0.015625, 256, 0, 1.44269502
    def c47, 0.0199999996, 0, 1, 4
    def c48, 0, 0.5, 0, 0
    dcl_texcoord v0.xyz
    dcl_texcoord2 v1.xyw
    dcl_texcoord3 v2
    dcl_2d s0
    dcl_2d s1
    dcl_2d s2
    dcl_2d s3
    dcl_2d s4

dcl_texcoord5 v5 // New input with corrected world coordinates

    add r0.x, c27.z, -v0.z // Using uncorrected coordinate here does better for black seam when camera is tilted.
    add r0, r0.x, c44.x
    texkill r0
    add r0.xyz, -c27, v5 // Use corrected world position
add r20.xyz, -c27, v0 // Interleaving corrected & uncorrected coords to improve remaining (non-black) seam when camera is tilted
    rcp r0.w, r0.z
rcp r20.w, r20.z
    mul r0.w, r0.w, -c27.z
mul r0.w, r20.w, -c27.z
    mul r0.xyz, r0.w, r0
    lrp r1.xyz, r0.w, v0, c27 // Use uncorrected world position - blends a little better at the edge of the map (still not great)
    dp3 r0.w, r0, r0
    rsq r0.w, r0.w
    rcp r2.x, r0.w
    mul r2.x, r2.x, c44.y
    max r3.x, c44.z, r2.x
    rcp r2.x, r3.x
    mul r3.z, r3.x, c43.x
    mul r2.x, r2.x, c39.x
    mul r2.yzw, r0.w, r0.xxyz
    mul r4.xy, r2.x, r2.yzzw
    mul r4.zw, r1.xyxy, c38.x
    texld r5, r4.zwzw, s1
    mad r5.xz, r5.y, r4.xyyw, r4.zyww
    texld r6, r5.xzzw, s1
    add r2.x, r5.y, r6.y
    mul r2.x, r2.x, c44.w
    mad r4.xy, r2.x, r4, r4.zwzw
    texld r5, r4, s1
    mul r1.xy, r4, c18.x
    mad r3.xy, r5.zwzw, c45.x, c45.y
    nrm r4.xyz, r3
    dp3 r2.x, r2.yzww, r4
    mul r2.yzw, r2, c45.xyyz
    mul r3.xyz, r2.x, r4
    add r2.x, r2.x, c44.z
    mad r5.xyz, r0, r0.w, -r3
    mad r3.xyz, r5, c40.x, r3
    dp3 r0.w, r3, r4
    cmp r0.w, r0.w, c46.z, -r0.w
    dp3 r0.x, r0, c28
    max r3.x, c47.x, r0.w
    dp3 r0.y, c30, r4
    max r3.y, r0.y, c46.z
    add r0.y, r3.y, r3.x
    mul r0.z, r3.y, r3.x
    rcp r0.z, r0.z
    mul r0.y, r0.y, c19.x
    mul r0.y, r0.z, r0.y
    mul r0.z, r0.y, r3.x
    rcp r0.z, r0.z
    add r3.x, r0.x, c46.y
    rcp r3.y, v1.w
    mul r3.yz, r3.y, v1.xxyw
    texld r5, r3.yzzw, s2
    mul r3.w, r5.w, c45.w
    add r4.w, r5.w, c46.x
    cmp r3.x, r4.w, r3.w, r3.x
    add r3.x, -r0.x, r3.x
    max r4.w, r3.x, c46.z
    mul r0.w, r0.w, r4.w
    mul r0.y, r0.y, r0.w
    mul r0.y, r0.y, c46.w
    exp r0.y, r0.y
    add r0.y, r0.y, -c44.z
    mul r0.y, r0.y, c37.x
    mul r0.y, r0.z, r0.y
    mul r0.yzw, r0.y, c35.xxyz
    mul r0.yzw, r0, c34.xxyz
    mov_sat r3.x, r4.w
    mul r3.x, r3.x, c41.x
    mad r3.xy, r4, r3.x, r3.yzzw
    texld r3, r3, s2
    mad r3.w, r3.w, c45.w, -r0.x
    cmp r3.xyz, r3.w, r3, r5
    mul oC0.w, r0.x, -c46.x
    mov r5.z, c44.z
    mad_sat r5.xyz, r4.w, -c36, r5.z
    mul r0.x, r4.w, c19.x
    mul r0.x, r0.x, c46.w
    exp r0.x, r0.x
    mul r3.xyz, r3, r5
    mad r0.xyz, r3, r0.x, r0.yzww
    add r3.xyz, r1, -c24
    dp3 r0.w, r3, c25
    dp3 r3.x, r3, c26
    add r3.x, -r3_abs.x, c44.z
    cmp r3.x, r3.x, c47.y, c47.z
    add r0.w, -r0_abs.w, c44.z
    cmp r0.w, r0.w, c47.y, c47.z
    add r0.w, r3.x, r0.w
    mov r3, c0
    cmp r3, -r0.w, r3, c8
    mov r1.w, c44.z
    dp4_sat r3.x, r1, r3
    mov r5, c1
    cmp r5, -r0.w, r5, c9
    dp4_sat r3.y, r1, r5
    cmp r5, -r0.w, c48.xxxy, c48.yxyy
    mad r3.xy, r3, c44.w, r5
    mov r3.w, c44.z
    mov r6, c2
    cmp r6, -r0.w, r6, c10
    dp4 r4.w, r1, r6
    texldp r6, v2, s4
    mad r5.x, r6.w, c23.y, c23.x
    mul r5.y, r5.x, c47.w
    cmp r5.x, -r0.w, r5.x, r5.y
    add r3.z, r4.w, r5.x
    texldp r3, r3, s3
    mov r6, c4
    cmp r6, -r0.w, r6, c12
    dp4_sat r3.x, r1, r6
    mov r6, c5
    cmp r6, -r0.w, r6, c13
    dp4_sat r3.y, r1, r6
    mad r6.xy, r3, c44.w, r5.zwzw
    mov r7, c6
    cmp r7, -r0.w, r7, c14
    mov r3.x, c21.x
    cmp r0.w, -r0.w, r3.x, c22.x
    dp4 r1.w, r1, r7
    add r1.xyz, r1, -c27
    add r6.z, r5.x, r1.w
    mov r6.w, c44.z
    texldp r5, r6, s3
    lrp r1.w, r0.w, r5.w, r3.w
    mov r3.x, c33.x
    mad r0.w, r1.w, r3.x, c29.x
    dp3 r1.w, r2.yzww, r4
    add r1.w, r1.w, r1.w
    mad r2.yzw, r4.xxyz, -r1.w, r2
    dp3 r3.x, r2.yzww, c15
    dp3 r3.y, r2.yzww, c16
    dp3 r1.w, r2.yzww, c17
    add r1.w, r1.w, r1.w
    rcp r1.w, r1.w
    mad r2.yz, r3.xxyw, r1.w, c44.w
    texld r3, r2.yzzw, s0
    mad r2.yzw, r0.xxyz, -r0.w, r3.xxyz
    mul r0.xyz, r0.w, r0
    mul r0.w, r2.x, r2.x
    mul r0.w, r0.w, r0.w
    mul r0.w, r0.w, r2.x
    mov r2.x, c20.x
    mad r0.w, r2.x, r0.w, c42.x
    mad r0.xyz, r0.w, r2.yzww, r0
    add r0.xyz, r0, -c31
    mul r0.w, r1.z, c32.y
    mul r1.w, r0.w, -c46.w
    rcp r0.w, r0.w
    exp r1.w, r1.w
    add r1.w, -r1.w, c44.z
    mul r0.w, r0.w, r1.w
    dp3 r1.x, r1, r1
    add r1.y, -r1_abs.z, c44.y
    rsq r1.x, r1.x
    rcp r1.x, r1.x
    mul r1.x, r1.x, c32.z
    mul r0.w, r0.w, r1.x
    cmp r0.w, r1.y, r1.x, r0.w
    mul r0.w, r0.w, -c32.x
    mul r0.w, r0.w, c46.w
    exp r0.w, r0.w
    mad oC0.xyz, r0.w, r0, c31

// approximately 164 instruction slots used (9 texture, 155 arithmetic)

